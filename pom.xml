<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 
         http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <groupId>com.bikeshare</groupId>
    <artifactId>bikeshare-testing-project</artifactId>
    <version>1.0.0</version>
    <packaging>jar</packaging>

    <name>BikeShare Testing Project</name>
    <description>
        A comprehensive Java project for teaching Software Testing concepts
        using a Shared Bike System domain. Includes progressive testing challenges
        from basic unit tests to advanced testing techniques.
    </description>

    <properties>
        <maven.compiler.source>21</maven.compiler.source>
        <maven.compiler.target>21</maven.compiler.target>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
        
        <!-- Dependency Versions -->
        <junit.version>5.10.0</junit.version>
        <mockito.version>5.5.0</mockito.version>
        <h2.version>2.2.220</h2.version>
        <jackson.version>2.15.2</jackson.version>
        <slf4j.version>2.0.7</slf4j.version>
        <logback.version>1.4.11</logback.version>
        <jetty.version>11.0.15</jetty.version>
        
        <!-- Plugin Versions -->
        <maven.surefire.version>3.1.2</maven.surefire.version>
        <maven.failsafe.version>3.1.2</maven.failsafe.version>
        <jacoco.version>0.8.10</jacoco.version>
        <pit.version>1.15.8</pit.version>
        <spotbugs.version>4.9.6.0</spotbugs.version>
        <checkstyle.version>3.3.1</checkstyle.version>
        <pmd.version>3.21.2</pmd.version>
        <exec.version>3.1.0</exec.version>
    </properties>

    <dependencies>
        <!-- Core Dependencies -->
        <dependency>
            <groupId>org.slf4j</groupId>
            <artifactId>slf4j-api</artifactId>
            <version>${slf4j.version}</version>
        </dependency>
        
        <dependency>
            <groupId>ch.qos.logback</groupId>
            <artifactId>logback-classic</artifactId>
            <version>${logback.version}</version>
        </dependency>

        <dependency>
            <groupId>com.fasterxml.jackson.core</groupId>
            <artifactId>jackson-databind</artifactId>
            <version>${jackson.version}</version>
        </dependency>

        <dependency>
            <groupId>com.fasterxml.jackson.datatype</groupId>
            <artifactId>jackson-datatype-jsr310</artifactId>
            <version>${jackson.version}</version>
        </dependency>

        <!-- Database -->
        <dependency>
            <groupId>com.h2database</groupId>
            <artifactId>h2</artifactId>
            <version>${h2.version}</version>
        </dependency>

        <!-- Web Dependencies -->
        <dependency>
            <groupId>org.eclipse.jetty</groupId>
            <artifactId>jetty-server</artifactId>
            <version>${jetty.version}</version>
        </dependency>
        
        <dependency>
            <groupId>org.eclipse.jetty</groupId>
            <artifactId>jetty-servlet</artifactId>
            <version>${jetty.version}</version>
        </dependency>

        <dependency>
            <groupId>org.eclipse.jetty</groupId>
            <artifactId>jetty-webapp</artifactId>
            <version>${jetty.version}</version>
        </dependency>

        <dependency>
            <groupId>javax.servlet</groupId>
            <artifactId>javax.servlet-api</artifactId>
            <version>4.0.1</version>
        </dependency>

        <!-- Testing Dependencies -->
        <dependency>
            <groupId>org.junit.jupiter</groupId>
            <artifactId>junit-jupiter</artifactId>
            <version>${junit.version}</version>
            <scope>test</scope>
        </dependency>

        <dependency>
            <groupId>org.mockito</groupId>
            <artifactId>mockito-core</artifactId>
            <version>${mockito.version}</version>
            <scope>test</scope>
        </dependency>

        <dependency>
            <groupId>org.mockito</groupId>
            <artifactId>mockito-junit-jupiter</artifactId>
            <version>${mockito.version}</version>
            <scope>test</scope>
        </dependency>

        <!-- AssertJ for fluent assertions (Lab 5 Advanced Testing) -->
        <dependency>
            <groupId>org.assertj</groupId>
            <artifactId>assertj-core</artifactId>
            <version>3.24.2</version>
            <scope>test</scope>
        </dependency>

        <!-- Mockito inline not available in this version, using standard mockito -->
        <!-- 
        <dependency>
            <groupId>org.mockito</groupId>
            <artifactId>mockito-inline</artifactId>
            <version>${mockito.version}</version>
            <scope>test</scope>
        </dependency>
        -->
    </dependencies>

    <build>
        <plugins>
            <!-- Compiler Plugin -->
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-compiler-plugin</artifactId>
                <version>3.11.0</version>
                <configuration>
                    <source>21</source>
                    <target>21</target>
                </configuration>
            </plugin>

            <!-- Surefire Plugin for Unit Tests -->
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-surefire-plugin</artifactId>
                <version>${maven.surefire.version}</version>
                <configuration>
                    <includes>
                        <include>**/*Test.java</include>
                        <include>**/*Tests.java</include>
                    </includes>
                    <excludes>
                        <exclude>**/*IntegrationTest.java</exclude>
                        <exclude>**/*E2ETest.java</exclude>
                    </excludes>
                </configuration>
            </plugin>

            <!-- Failsafe Plugin for Integration Tests -->
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-failsafe-plugin</artifactId>
                <version>${maven.failsafe.version}</version>
                <configuration>
                    <includes>
                        <include>**/*IntegrationTest.java</include>
                        <include>**/*E2ETest.java</include>
                    </includes>
                </configuration>
                <executions>
                    <execution>
                        <goals>
                            <goal>integration-test</goal>
                            <goal>verify</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>

            <!-- JaCoCo Plugin for Code Coverage -->
            <plugin>
                <groupId>org.jacoco</groupId>
                <artifactId>jacoco-maven-plugin</artifactId>
                <version>${jacoco.version}</version>
                <executions>
                    <execution>
                        <id>prepare-agent</id>
                        <goals>
                            <goal>prepare-agent</goal>
                        </goals>
                    </execution>
                    <execution>
                        <id>report</id>
                        <phase>test</phase>
                        <goals>
                            <goal>report</goal>
                        </goals>
                    </execution>
                    <execution>
                        <id>check</id>
                        <goals>
                            <goal>check</goal>
                        </goals>
                        <configuration>
                            <rules>
                                <rule>
                                    <element>BUNDLE</element>
                                    <limits>
                                        <limit>
                                            <counter>INSTRUCTION</counter>
                                            <value>COVEREDRATIO</value>
                                            <minimum>0.00</minimum>  <!-- No minimum for student repository -->
                                        </limit>
                                    </limits>
                                </rule>
                            </rules>
                        </configuration>
                    </execution>
                </executions>
            </plugin>

            <!-- PIT Mutation Testing Plugin -->
            <plugin>
                <groupId>org.pitest</groupId>
                <artifactId>pitest-maven</artifactId>
                <version>${pit.version}</version>
                <dependencies>
                    <dependency>
                        <groupId>org.pitest</groupId>
                        <artifactId>pitest-junit5-plugin</artifactId>
                        <version>1.2.1</version>
                    </dependency>
                </dependencies>
                <configuration>
                    <!-- Classes to mutate -->
                    <targetClasses>
                        <param>com.bikeshare.model.*</param>
                        <param>com.bikeshare.service.*</param>
                        <param>com.bikeshare.repository.*</param>
                    </targetClasses>
                    <!-- Test classes to run -->
                    <targetTests>
                        <param>com.bikeshare.*</param>
                    </targetTests>
                    <!-- Classes to exclude from mutation -->
                    <excludedClasses>
                        <param>com.bikeshare.config.*</param>
                        <param>com.bikeshare.Application</param>
                        <param>com.bikeshare.demo.*</param>
                        <param>com.bikeshare.web.*</param>
                    </excludedClasses>
                    <!-- Methods to exclude -->
                    <excludedMethods>
                        <param>toString</param>
                        <param>hashCode</param>
                        <param>equals</param>
                    </excludedMethods>
                    <!-- Mutation operators to use -->
                    <mutators>
                        <mutator>DEFAULTS</mutator>
                    </mutators>
                    <!-- Output formats -->
                    <outputFormats>
                        <outputFormat>HTML</outputFormat>
                        <outputFormat>XML</outputFormat>
                    </outputFormats>
                    <!-- Number of threads -->
                    <threads>2</threads>
                    <!-- Timeout in milliseconds -->
                    <timeoutConstant>4000</timeoutConstant>
                    <!-- Memory in MB -->
                    <jvmArgs>
                        <jvmArg>-Xmx1024m</jvmArg>
                    </jvmArgs>
                    <!-- Verbose reporting for education -->
                    <verbose>true</verbose>
                    <!-- Skip failing tests -->
                    <skipFailingTests>true</skipFailingTests>
                </configuration>
            </plugin>

            <!-- SpotBugs Plugin for Static Analysis -->
            <plugin>
                <groupId>com.github.spotbugs</groupId>
                <artifactId>spotbugs-maven-plugin</artifactId>
                <version>${spotbugs.version}</version>
                <configuration>
                    <effort>Max</effort>
                    <threshold>Low</threshold>
                    <xmlOutput>true</xmlOutput>
                    <failOnError>false</failOnError>
                </configuration>
            </plugin>

            <!-- Checkstyle Plugin for Code Style -->
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-checkstyle-plugin</artifactId>
                <version>${checkstyle.version}</version>
                <configuration>
                    <configLocation>google_checks.xml</configLocation>
                    <consoleOutput>true</consoleOutput>
                    <failsOnError>false</failsOnError>
                    <violationSeverity>warning</violationSeverity>
                </configuration>
            </plugin>

            <!-- PMD Plugin for Code Quality -->
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-pmd-plugin</artifactId>
                <version>${pmd.version}</version>
                <configuration>
                    <rulesets>
                        <ruleset>/rulesets/java/quickstart.xml</ruleset>
                    </rulesets>
                    <failOnViolation>false</failOnViolation>
                    <printFailingErrors>true</printFailingErrors>
                    <!-- PMD 6.55.0 doesn't support Java 21, use 17 as target -->
                    <targetJdk>17</targetJdk>
                </configuration>
            </plugin>

            <!-- Exec Plugin for Running Main Classes -->
            <plugin>
                <groupId>org.codehaus.mojo</groupId>
                <artifactId>exec-maven-plugin</artifactId>
                <version>${exec.version}</version>
                <configuration>
                    <mainClass>com.bikeshare.web.SimpleBikeShareWebServer</mainClass>
                    <args>
                        <arg>8081</arg>
                    </args>
                </configuration>
            </plugin>
        </plugins>
    </build>

    <!-- Profiles for Different Testing Labs -->
    <profiles>
        <!-- Lab 1: Basic Unit Tests -->
        <profile>
            <id>lab1</id>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-surefire-plugin</artifactId>
                        <configuration>
                            <includes>
                                <include>**/lab1/**/*Test.java</include>
                            </includes>
                        </configuration>
                    </plugin>
                </plugins>
            </build>
        </profile>

        <!-- Lab 2: Black Box Testing -->
        <profile>
            <id>lab2</id>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-surefire-plugin</artifactId>
                        <configuration>
                            <includes>
                                <include>**/lab2/**/*Test.java</include>
                            </includes>
                        </configuration>
                    </plugin>
                </plugins>
            </build>
        </profile>

        <!-- Lab 3: Structural Testing -->
        <profile>
            <id>lab3</id>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-surefire-plugin</artifactId>
                        <configuration>
                            <includes>
                                <include>**/lab3/**/*Test.java</include>
                            </includes>
                        </configuration>
                    </plugin>
                </plugins>
            </build>
        </profile>

        <!-- All Tests Profile -->
        <profile>
            <id>all-tests</id>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-surefire-plugin</artifactId>
                        <configuration>
                            <includes>
                                <include>**/*Test.java</include>
                                <include>**/*Tests.java</include>
                            </includes>
                        </configuration>
                    </plugin>
                </plugins>
            </build>
        </profile>

        <!-- Lab 4: Mutation Testing Profile -->
        <profile>
            <id>lab4</id>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-surefire-plugin</artifactId>
                        <configuration>
                            <includes>
                                <include>**/lab4/**/*Test.java</include>
                            </includes>
                        </configuration>
                    </plugin>
                </plugins>
            </build>
        </profile>

        <!-- Lab 5: Advanced Tools & Static Analysis Profile -->
        <profile>
            <id>lab5</id>
            <build>
                <plugins>
                    <!-- Run Lab 5 tests -->
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-surefire-plugin</artifactId>
                        <configuration>
                            <includes>
                                <include>**/lab5/**/*Test.java</include>
                            </includes>
                        </configuration>
                    </plugin>
                    
                    <!-- SpotBugs Static Analysis -->
                    <plugin>
                        <groupId>com.github.spotbugs</groupId>
                        <artifactId>spotbugs-maven-plugin</artifactId>
                        <version>${spotbugs.version}</version>
                        <executions>
                            <execution>
                                <id>analyze</id>
                                <phase>verify</phase>
                                <goals>
                                    <goal>check</goal>
                                </goals>
                            </execution>
                        </executions>
                    </plugin>
                    
                    <!-- Checkstyle Code Style -->
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-checkstyle-plugin</artifactId>
                        <version>${checkstyle.version}</version>
                        <executions>
                            <execution>
                                <id>validate</id>
                                <phase>verify</phase>
                                <goals>
                                    <goal>check</goal>
                                </goals>
                            </execution>
                        </executions>
                    </plugin>
                    
                    <!-- PMD Code Quality -->
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-pmd-plugin</artifactId>
                        <version>${pmd.version}</version>
                        <executions>
                            <execution>
                                <id>analyze</id>
                                <phase>verify</phase>
                                <goals>
                                    <goal>check</goal>
                                </goals>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>


        <!-- Lab 5: Mutation Testing Profile -->
        <profile>
            <id>mutation-testing</id>
            <build>
                <plugins>
                    <!-- Enhanced PIT Configuration for Educational Purposes -->
                    <plugin>
                        <groupId>org.pitest</groupId>
                        <artifactId>pitest-maven</artifactId>
                        <version>${pitest.version}</version>
                        <dependencies>
                            <dependency>
                                <groupId>org.pitest</groupId>
                                <artifactId>pitest-junit5-plugin</artifactId>
                                <version>1.2.1</version>
                            </dependency>
                        </dependencies>
                        <configuration>
                            <!-- Focus on core business logic for students -->
                            <targetClasses>
                                <param>com.bikeshare.model.*</param>
                                <param>com.bikeshare.service.*</param>
                                <param>com.bikeshare.service.validation.impl.*</param>
                            </targetClasses>
                            
                            <!-- Include all test classes -->
                            <targetTests>
                                <param>com.bikeshare.*Test</param>
                                <param>com.bikeshare.*Tests</param>
                            </targetTests>
                            
                            <!-- Exclude non-business logic -->
                            <excludedClasses>
                                <param>com.bikeshare.config.*</param>
                                <param>com.bikeshare.Application</param>
                                <param>com.bikeshare.demo.*</param>
                                <param>com.bikeshare.web.*</param>
                                <param>com.bikeshare.repository.*</param>
                            </excludedClasses>
                            
                            <!-- Exclude utility methods -->
                            <excludedMethods>
                                <param>toString</param>
                                <param>hashCode</param>
                                <param>equals</param>
                                <param>getter*</param>
                                <param>setter*</param>
                            </excludedMethods>
                            
                            <!-- Use all default mutators for comprehensive testing -->
                            <mutators>
                                <mutator>STRONGER</mutator>
                            </mutators>
                            
                            <!-- Generate detailed reports -->
                            <outputFormats>
                                <outputFormat>HTML</outputFormat>
                                <outputFormat>XML</outputFormat>
                                <outputFormat>CSV</outputFormat>
                            </outputFormats>
                            
                            <!-- Educational settings -->
                            <verbose>true</verbose>
                            <timestampedReports>false</timestampedReports>
                            <threads>2</threads>
                            <timeoutConstant>6000</timeoutConstant>
                            <timeoutFactor>1.25</timeoutFactor>
                            
                            <!-- Memory settings -->
                            <jvmArgs>
                                <jvmArg>-Xmx2048m</jvmArg>
                                <jvmArg>-XX:+UseG1GC</jvmArg>
                            </jvmArgs>
                            
                            <!-- Skip failing tests to focus on mutation quality -->
                            <skipFailingTests>true</skipFailingTests>
                            
                            <!-- Minimum mutation coverage thresholds -->
                            <mutationThreshold>70</mutationThreshold>
                            <coverageThreshold>80</coverageThreshold>
                        </configuration>
                        <executions>
                            <execution>
                                <id>mutation-test</id>
                                <goals>
                                    <goal>mutationCoverage</goal>
                                </goals>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>

        <!-- Quick Mutation Testing for Demos -->
        <profile>
            <id>mutation-demo</id>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.pitest</groupId>
                        <artifactId>pitest-maven</artifactId>
                        <version>${pitest.version}</version>
                        <dependencies>
                            <dependency>
                                <groupId>org.pitest</groupId>
                                <artifactId>pitest-junit5-plugin</artifactId>
                                <version>1.2.1</version>
                            </dependency>
                        </dependencies>
                        <configuration>
                            <!-- Focus on key classes for quick demo -->
                            <targetClasses>
                                <param>com.bikeshare.service.validation.impl.AlcoholPurchaseValidator</param>
                                <param>com.bikeshare.model.User</param>
                                <param>com.bikeshare.service.validation.AgeValidator</param>
                            </targetClasses>
                            
                            <targetTests>
                                <param>com.bikeshare.lectures.*</param>
                                <param>com.bikeshare.lab3.*</param>
                            </targetTests>
                            
                            <mutators>
                                <mutator>CONDITIONALS_BOUNDARY</mutator>
                                <mutator>INCREMENTS</mutator>
                                <mutator>MATH</mutator>
                                <mutator>NEGATE_CONDITIONALS</mutator>
                            </mutators>
                            
                            <outputFormats>
                                <outputFormat>HTML</outputFormat>
                            </outputFormats>
                            
                            <verbose>true</verbose>
                            <threads>1</threads>
                            <timeoutConstant>3000</timeoutConstant>
                        </configuration>
                    </plugin>
                </plugins>
            </build>
        </profile>

        <!-- Coverage vs Mutation Comparison Profile -->
        <profile>
            <id>coverage-comparison</id>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.pitest</groupId>
                        <artifactId>pitest-maven</artifactId>
                        <version>${pitest.version}</version>
                        <dependencies>
                            <dependency>
                                <groupId>org.pitest</groupId>
                                <artifactId>pitest-junit5-plugin</artifactId>
                                <version>1.2.1</version>
                            </dependency>
                        </dependencies>
                        <configuration>
                            <!-- Target classes for mutation analysis -->
                            <targetClasses>
                                <param>com.bikeshare.service.validation.AgeValidator</param>
                                <param>com.bikeshare.model.User</param>
                            </targetClasses>
                            
                            <!-- Coverage-focused test analysis -->
                            <targetTests>
                                <param>com.bikeshare.lectures.CoverageEx</param>
                            </targetTests>
                            
                            <!-- Use comprehensive mutators for better comparison -->
                            <mutators>
                                <mutator>DEFAULTS</mutator>
                            </mutators>
                            
                            <outputFormats>
                                <outputFormat>HTML</outputFormat>
                                <outputFormat>XML</outputFormat>
                            </outputFormats>
                            
                            <verbose>true</verbose>
                            <threads>2</threads>
                            <timeoutConstant>4000</timeoutConstant>
                            
                            <!-- Generate detailed reports for comparison -->
                            <exportLineCoverage>true</exportLineCoverage>
                            <timestampedReports>false</timestampedReports>
                        </configuration>
                    </plugin>
                </plugins>
            </build>
        </profile>
    </profiles>
</project>
